/**
 * PJP ToolTip 
 * contains PJU Hover function
 * NOTE Namespace: $('foo').myPlugin(options{p_foo:bar}) { var myPrivate; }
 * NOTE For conflicting property namespaces: plugin -> p_foo  utility -> u_foo
 * TODO window control, dynamic stems
 * TODO snap trigger, dynamic side
 * TODO dynamic dims
 * TODO x-browser
 * @param       {jQuery object}     set of matched elements
 * @see         http://cherne.net/brian/resources/jquery.hoverIntent.html
 * @requires    jQuery 1.2+
 * @package     Peng's JQuery Plugins
 * @subpackage  Peng's WordPress Frontend
 * @version     1.0
 * @author      peng@pengxwang.com
 */

(function(g){g.fn.pjpTip=function(a){a=g.extend({},{filters:undefined,p_type:"attribute",p_selector_class:"pjpTipTrigger",p_attr:"title",tip_class:"jTip",tip_inner_class:"in",tip_id:"pjpTip",tip_parent:"body",stem_class:"jStem",do_stem:true,do_follow:true,do_lock_x:false,do_lock_y:true,do_snap:true,do_fade:true,fade_in:200,fade_out:100,off_x:0,off_y:24,mouse:8,interval:300,timeout:0},a);return this.each(function(){$this=g(this);new g.PJPTip(a,$this)})};g.pjuHover=function(a,f){for(var c=(a.type==
"mouseover"?a.fromElement:a.toElement)||a.relatedTarget;c&&c!=f;)try{c=c.parentNode}catch(b){c=f}if(c==f)return false};g.PJPTip=function(a,f){var c={isHover:{timer:undefined,state:false}},b={myContent:undefined,myLeft:undefined,myTop:undefined,isSet:false,my$:undefined,my$In:undefined},d={currX:undefined,currY:undefined,prevX:undefined,prevY:undefined,sensitivity:a.mouse},k=function(e){c.isHover.timer=setTimeout(function(){c.isHover.timer=clearTimeout(c.isHover.timer);if(Math.abs(d.prevX-d.currX)+
Math.abs(d.prevY-d.currY)<d.sensitivity){c.isHover.state=true;b.my$=g("<div></div>").appendTo(a.tip_parent).html(b.myContent).attr({id:a.tip_id,className:a.tip_class});b.my$In=b.my$.wrapInner("<div></div>").children("div").attr("class",a.tip_inner_class);a.do_stem==true&&b.my$.prepend("<div></div>").children("div").not("."+a.tip_inner_class).attr("class",a.stem_class);b.my$In.css("max-width")&&parseInt(b.my$In.width())>=parseInt(b.my$In.css("max-width"))&&b.my$In.css("width",parseInt(b.my$In.css("max-width")));
i();a.do_fade==true&&b.my$.hide().fadeIn(a.fade_in);b.isSet=true}else{j();k(e)}},a.interval)},j=function(e){if(e){d.prevX=e.pageX;d.prevY=e.pageY}else{d.prevX=d.currX;d.prevY=d.currY}},l=function(e){d.currX=e.pageX;d.currY=e.pageY;i()},i=function(){if(c.isHover.state==true&&a.do_follow==true){if(!(a.do_lock_x==true&&b.isSet==true))b.myLeft=d.currX+a.off_x;if(!(a.do_lock_y==true&&b.isSet==true))b.myTop=d.currY+a.off_y;b.my$.css({top:b.myTop,left:b.myLeft})}},o=function(){c.isHover.timer=clearTimeout(c.isHover.timer);
c.isHover.state=false;if(b.isSet==true){b.isSet=false;a.do_fade?b.my$.fadeOut(a.fade_out,function(){b.my$.remove()}):b.my$.remove()}},n=function(e){var m=g.extend({},e);if(g.pjuHover&&g.pjuHover(e,this)==false)return false;if(c.isHover.timer)c.isHover.timer=clearTimeout(c.isHover.timer);if(e.type=="mouseover"){j(m);f.bind("mousemove",l);c.isHover.state==false&&k(m)}else if(e.type=="mouseout"){f.unbind("mousemove",l);if(c.isHover.state==true)c.isHover.timer=setTimeout(function(){o()},a.timeout)}},
h;a:switch(a.p_type){case "attribute":b.myContent=f.attr(a.p_attr);f.attr(a.p_attr,"");if(b.myContent==""){h=false;break a}if(a.filters&&f.is(a.filters)){h=false;break a}f.find("*["+a.p_attr+"]").attr(a.p_attr,"");if(b.myContent.search(/http:\/\//)!=-1)b.myContent=b.myContent.replace(/(http:\/\/www\.)|(http:\/\/)/i,"");break;case "selector":break}if(h==false)return f;return f.mouseover(n).mouseout(n)}})(jQuery);

